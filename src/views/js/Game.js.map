{"version":3,"file":"Game.js","sourceRoot":"","sources":["Game.ts"],"names":[],"mappings":"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","sourcesContent":["import Display = require('./Display');\nimport Assets = require('./Assets');\nimport IState = require(\"./IState\");\nimport GameState = require(\"./GameState\");\nimport StateManager = require(\"./StateManager\");\nimport KeyboardManager = require(\"./KeyboardManager\");\nimport MapLoader = require(\"./MapLoader\");\nclass Game{\n    public width;\n    public height;\n    public running = false;\n    public g;\n    private keyboardManager;\n    //states\n    private gameState:IState;\n    assets;\n    display;\n\n    constructor(width:number, height:number,display){\n        this.width = width;\n        this.height = height;\n        this.keyboardManager = new KeyboardManager();\n        this.display = display;\n    }\n    init(){\n        this.g = Display.getGraphics(2);\n        // this.assets = new Assets(`${__dirname}/../../../res/textures/PlatformPack/Tile-SpriteSheet/tiles.json`);\n        this.gameState = new GameState(this);\n        StateManager.setState(this.gameState);\n        let ml = new MapLoader();\n    }\n    tick(_td){\n        this.keyboardManager.tick();\n        if(StateManager.getState() != undefined){\n            StateManager.getState().tick(_td);\n        }\n    }\n    render(){\n        this.g.clearRect(0,0,this.width,this.height);\n        if(StateManager.getState() != undefined){\n            StateManager.getState().render(this.g);\n        }\n        this.display.tilemap.layers.forEach(function (layer,index) {\n            MapLoader.render(layer.data,Display.getGraphics(index),layer.width,layer.height);\n\n        }.bind(this));\n    }\n    \n    start(){\n        if(this.running) return;\n        this.init();\n        this.running=true;\n        this.run();\n    }\n    run(){\n        let fps = 60;\n        let timePerTick = 1000/fps;\n        let delta = 0;\n        let now;\n        let lastTime = Date.now();\n        let timer = 0;\n        let ticks = 0;\n        function loop(){\n            if(this.running){\n                now = Date.now();\n                delta = now-lastTime;\n                timer+=delta;\n                lastTime = now;\n            }\n            if(timer>timePerTick){\n                let dt = timer/1000;\n                this.tick(dt);\n                this.render();\n                timer = 0;\n            }\n            window.requestAnimationFrame(loop.bind(this));\n        }\n        loop.call(this);\n    }\n    getKeyboardManager():KeyboardManager{\n        return this.keyboardManager;\n    }\n}\nexport = Game;"]}